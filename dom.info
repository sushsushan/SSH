#!/bin/bash

# Define colors
MAGENTA='\033[35m'
NC='\033[0m'  # No Color
BLUE='\033[34m'
CYAN='\033[36m'
GREEN='\033[32m'
RED='\033[31m'
YELLOW='\033[33m'

# Print header
clear
echo -e "${MAGENTA}-----------------------------------------------------------"
echo -e "${MAGENTA}| ${CYAN}Number ${MAGENTA}| ${CYAN}Domain Name${MAGENTA}                                          | ${CYAN}Expiry Date${MAGENTA}       |"
echo -e "${MAGENTA}-----------------------------------------------------------${NC}"

# Fetch and format domain list
output=$(whmapi1 listaccts --output=json | jq -r '.data.acct[] | select(.domain != null) | [.domain, .unix_startdate] | @tsv' | sort)

if [ -z "$output" ]; then
    echo -e "${RED}No domains found.${NC}"
    exit 1
fi

counter=1
while IFS=$'\t' read -r domain created_date; do
    # Convert Unix timestamp to readable date format
    expiry_date=$(date -d @"$created_date" +"%Y-%m-%d")
    
    # Set alternating row colors
    if ((counter % 2 == 0)); then
        row_color="$BLUE"
    else
        row_color="$CYAN"
    fi
    
    # Print each row with formatted columns
    printf "${MAGENTA}| ${NC}%-6s ${MAGENTA}| ${NC}%-45s ${MAGENTA}| ${row_color}%-15s ${MAGENTA}|
${NC}" "$counter" "$domain" "$expiry_date"
    
    ((counter++))
done <<< "$output"

echo -e "${MAGENTA}-----------------------------------------------------------${NC}"
echo -e "${GREEN}Total Domains: $((counter - 1))${NC}"
