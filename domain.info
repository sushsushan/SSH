#!/bin/bash

# Define colors
RED='\033[1;31m'
GREEN='\033[1;32m'
YELLOW='\033[1;33m'
BLUE='\033[1;34m'
MAGENTA='\033[1;35m'
CYAN='\033[1;36m'
NC='\033[0m' # No color

# Run the uapi command to get domain details
output=$(uapi DomainInfo domains_data)

# Extract required fields using grep and awk
domains=($(echo "$output" | grep -E "domain: " | awk '{print $2}'))
documentroots=($(echo "$output" | grep -E "documentroot: " | awk '{print $2}'))
types=($(echo "$output" | grep -E "type: " | awk '{print $2}'))

# Calculate the number of domains found
count=${#domains[@]}

# Initialize counters for domain types
main_count=0
addon_count=0
parked_count=0
subdomain_count=0

# Function to print a table border
print_border() {
    printf "${MAGENTA}+%-42s+%-62s+%-17s+${NC}\n" "$(printf -- '-%.0s' {1..42})" "$(printf -- '-%.0s' {1..62})" "$(printf -- '-%.0s' {1..17})"
}

# Print header with border
print_border
printf "${MAGENTA}| ${BLUE}%-40s${MAGENTA} | ${YELLOW}%-60s${MAGENTA} | ${GREEN}%-15s${MAGENTA} |\n${NC}" "Domain Name" "Document Root/Path" "Type"
print_border

# Print rows of the table
for ((i=0; i<count; i++)); do
    # Normalize domain type to lowercase and remove underscores
    type_normalized=$(echo "${types[i]}" | tr '[:upper:]' '[:lower:]' | tr '_' '')

    # Count domain types correctly
    case "$type_normalized" in
        main|maindomain) ((main_count++)) ;;
        addon|addondomain) ((addon_count++)) ;;
        parked|parkeddomain) ((parked_count++)) ;;
        subdomain|sub_domain) ((subdomain_count++)) ;;
    esac

    # Set row color based on type
    row_color=$NC
    case "$type_normalized" in
        main) row_color=$CYAN ;;
        addon) row_color=$YELLOW ;;
        parked) row_color=$RED ;;
        subdomain) row_color=$GREEN ;;
    esac
    
    # Print table row
    printf "${MAGENTA}| ${NC}%-40s ${MAGENTA}| ${NC}%-60s ${MAGENTA}| ${row_color}%-15s ${MAGENTA}|\n${NC}" "${domains[i]}" "${documentroots[i]}" "${types[i]}"
done

# Print bottom border
print_border

# Print summary with colors
total_domains=$((main_count + addon_count + parked_count + subdomain_count))

echo -e "\n${CYAN}Summary:${NC}"
echo -e "  ${BLUE}Main Domains:${NC}      ${main_count}"
echo -e "  ${YELLOW}Addon Domains:${NC}     ${addon_count}"
echo -e "  ${RED}Parked Domains:${NC}    ${parked_count}"
echo -e "  ${GREEN}Subdomains:${NC}       ${subdomain_count}"
echo -e "  ${MAGENTA}Total Domains:${NC}     ${total_domains}\n"
