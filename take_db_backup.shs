#!/bin/bash

# Color Codes
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Welcome Message
echo -e "${CYAN}=========================================${NC}"
echo -e "${YELLOW}       ğŸš€ Database Backup Tool ğŸš€       ${NC}"
echo -e "${CYAN}=========================================${NC}\n"

# Fetch existing databases
echo -e "${BLUE}ğŸ” Fetching available databases...${NC}\n"
EXISTING_DBS=$(uapi Mysql list_databases | grep -oP '(?<=database:\s).+')

# Display Databases in a Clear Table Format
echo -e "${GREEN}---------------------------------------------${NC}"
echo -e "${YELLOW}|          ğŸ¯ Available Databases             |${NC}"
echo -e "${GREEN}---------------------------------------------${NC}"
index=1
while IFS= read -r db; do
    printf "${CYAN}| %2d. %-35s |${NC}\n" "$index" "$db"
    ((index++))
done <<< "$EXISTING_DBS"
echo -e "${GREEN}---------------------------------------------${NC}\n"

# Prompt User for Database Selection
while true; do
    read -p "ğŸ”¥ Enter the database name you want to back up: " DB_NAME
    if echo "$EXISTING_DBS" | grep -q "^$DB_NAME$"; then
        break
    else
        echo -e "${RED}[âŒ ERROR] Database '$DB_NAME' not found. Please enter a valid database name.${NC}"
    fi
done

# Generate Backup Directory
mkdir -p ~/backup
BACKUP_FILE=~/backup/"$DB_NAME"_$(date +"%Y%m%d_%H%M%S").sql

# Start Backup
echo -e "\n${YELLOW}â³ Starting backup for database '${DB_NAME}', please wait...${NC}\n"
mysqldump "$DB_NAME" > "$BACKUP_FILE" 2>/dev/null

# Display Backup Details
BACKUP_SIZE=$(du -h "$BACKUP_FILE" | cut -f1)
echo -e "${GREEN}=========================================${NC}"
echo -e "${BLUE}       âœ… Backup Completed Successfully!      ${NC}"
echo -e "${GREEN}=========================================${NC}"
echo -e "${YELLOW}ğŸ“‚ Backup File: ${NC}$BACKUP_FILE"
echo -e "${YELLOW}ğŸ“¦ Backup Size: ${NC}$BACKUP_SIZE"
echo -e "${GREEN}=========================================${NC}"
echo -e "ğŸ‰ ${CYAN}Process completed! Have a great day!${NC} ğŸš€\n"
