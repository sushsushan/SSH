#!/bin/bash

# Define colors
RED="\033[1;31m"
GREEN="\033[1;32m"
YELLOW="\033[1;33m"
CYAN="\033[1;36m"
RESET="\033[0m"

# Fetch domain data
OUTPUT=$(uapi DomainInfo domains_data --output=json)

# Initialize arrays
declare -a primary_domains parked_domains addon_domains sub_domains
declare -A domain_roots domain_types

# Extract domain names, document roots, and types using grep & awk
echo "$OUTPUT" | grep -E '"domain":|"documentroot":|"type":' | sed 's/[",]//g' | while read -r line; do
    key=$(echo "$line" | awk '{print $1}')
    value=$(echo "$line" | awk '{print $2}')

    if [[ $key == "domain:" ]]; then
        current_domain=$value
    elif [[ $key == "documentroot:" ]]; then
        domain_roots[$current_domain]=$value
    elif [[ $key == "type:" ]]; then
        domain_types[$current_domain]=$value
        case $value in
            main_domain) primary_domains+=("$current_domain") ;;
            parked_domain) parked_domains+=("$current_domain") ;;
            addon_domain) addon_domains+=("$current_domain") ;;
            sub_domain) sub_domains+=("$current_domain") ;;
        esac
    fi
done

# Print header
echo -e "${YELLOW}-------------------------------------------------------------"
echo -e "| ${CYAN}Domain Name            | Document Root                  | Type       ${YELLOW}|"
echo -e "-------------------------------------------------------------${RESET}"

# Function to print domain rows
print_domains() {
    local type_color="$1"
    shift
    local domains=("$@")

    for domain in "${domains[@]}"; do
        printf "| ${type_color}%-22s${RESET} | %-30s | %-10s |\n" \
            "$domain" "${domain_roots[$domain]}" "${domain_types[$domain]}"
    done
}

# Print domains in order
print_domains "$GREEN" "${primary_domains[@]}"    # Primary domains (Green)
print_domains "$YELLOW" "${parked_domains[@]}"    # Parked domains (Yellow)
print_domains "$CYAN" "${addon_domains[@]}"       # Addon domains (Cyan)
print_domains "$RED" "${sub_domains[@]}"          # Subdomains (Red)

# Print footer
echo -e "${YELLOW}-------------------------------------------------------------${RESET}"

# Print summary
echo -e "\n${GREEN}Total Domains: ${#primary_domains[@]} Primary, ${#parked_domains[@]} Parked, ${#addon_domains[@]} Addon, ${#sub_domains[@]} Subdomains${RESET}\n"
